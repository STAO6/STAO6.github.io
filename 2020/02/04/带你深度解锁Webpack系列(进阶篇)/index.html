<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="webpack," />










<meta name="description" content="带你深度解锁Webpack系列(进阶篇)三篇长文，带你解锁 Webpack ，希望读完这三篇文章，你能够对 webpack 的各项配置有一个更为清晰的认识。 本文是第二篇，如果你还没有阅读《带你深度解锁Webpack系列(基础篇)》，建议阅读之后，再继续阅读本文。 本文会引入更多的 webpack 配置，如果文中有任何错误，欢迎在评论区指正，我会尽快修正。 webpack 优化部分放在了下一篇。">
<meta name="keywords" content="webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="深度解锁Webpack系列(进阶篇)">
<meta property="og:url" content="http:&#x2F;&#x2F;yoursite.com&#x2F;2020&#x2F;02&#x2F;04&#x2F;%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%BA%A6%E8%A7%A3%E9%94%81Webpack%E7%B3%BB%E5%88%97(%E8%BF%9B%E9%98%B6%E7%AF%87)&#x2F;index.html">
<meta property="og:site_name" content="STAO_blog">
<meta property="og:description" content="带你深度解锁Webpack系列(进阶篇)三篇长文，带你解锁 Webpack ，希望读完这三篇文章，你能够对 webpack 的各项配置有一个更为清晰的认识。 本文是第二篇，如果你还没有阅读《带你深度解锁Webpack系列(基础篇)》，建议阅读之后，再继续阅读本文。 本文会引入更多的 webpack 配置，如果文中有任何错误，欢迎在评论区指正，我会尽快修正。 webpack 优化部分放在了下一篇。">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7ee866b278?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7eedad0932?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7ef26d2ca3?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7ef4ea39dd?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7ef6dc0875?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7ef7c6718b?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7f6f69cfb5?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7f724b6757?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">
<meta property="og:updated_time" content="2020-05-06T07:44:05.690Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;user-gold-cdn.xitu.io&#x2F;2020&#x2F;3&#x2F;9&#x2F;170bae7ee866b278?imageView2&#x2F;0&#x2F;w&#x2F;1280&#x2F;h&#x2F;960&#x2F;format&#x2F;webp&#x2F;ignore-error&#x2F;1">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'STAO'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2020/02/04/带你深度解锁Webpack系列(进阶篇)/"/>





  <title>深度解锁Webpack系列(进阶篇) | STAO_blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">STAO_blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/02/04/%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%BA%A6%E8%A7%A3%E9%94%81Webpack%E7%B3%BB%E5%88%97(%E8%BF%9B%E9%98%B6%E7%AF%87)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="STAO">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="STAO_blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">深度解锁Webpack系列(进阶篇)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-02-04T14:32:34+08:00">
                2020-02-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CODE/" itemprop="url" rel="index">
                    <span itemprop="name">CODE</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="带你深度解锁Webpack系列-进阶篇"><a href="#带你深度解锁Webpack系列-进阶篇" class="headerlink" title="带你深度解锁Webpack系列(进阶篇)"></a>带你深度解锁Webpack系列(进阶篇)</h1><p>三篇长文，带你解锁 <code>Webpack</code> ，希望读完这三篇文章，你能够对 <code>webpack</code> 的各项配置有一个更为清晰的认识。</p>
<p>本文是第二篇，如果你还没有阅读<a href="https://juejin.im/post/5e5c65fc6fb9a07cd00d8838" target="_blank" rel="noopener">《带你深度解锁Webpack系列(基础篇)》</a>，建议阅读之后，再继续阅读本文。</p>
<p>本文会引入更多的 <code>webpack</code> 配置，如果文中有任何错误，欢迎在评论区指正，我会尽快修正。 <code>webpack</code> 优化部分放在了下一篇。</p>
<p>推荐大家参考本文一步一步进行配置，不要总是想着找什么最佳配置，掌握之后，根据自己的需求配置出来的，就是最佳配置。</p>
<p>本文对应的项目地址(编写本文时使用) 供参考：<a href="https://github.com/YvetteLau/webpack/tree/master/webpack-second" target="_blank" rel="noopener">github.com/YvetteLau/w…</a></p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7ee866b278?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="1-静态资源拷贝"><a href="#1-静态资源拷贝" class="headerlink" title="1. 静态资源拷贝"></a>1. 静态资源拷贝</h3><p>有些时候，我们需要使用已有的JS文件、CSS文件（本地文件），但是不需要 <code>webpack</code> 编译。例如，我们在 <code>public/index.html</code> 中引入了 <code>public</code> 目录下的 <code>js</code> 或 <code>css</code> 文件。这个时候，如果直接打包，那么在构建出来之后，肯定是找不到对应的 <code>js</code> / <code>css</code> 了。</p>
<blockquote>
<p><code>public</code> 目录结构</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">├── public</span><br><span class="line">│   ├── config.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── js</span><br><span class="line">│   │   ├── base.js</span><br><span class="line">│   │   └── other.js</span><br><span class="line">│   └── login.html</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>现在，我们在 <code>index.html</code> 中引入了 <code>./js/base.js</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- index.html --&gt;</span><br><span class="line">&lt;script src=&quot;./js/base.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这时候，我们 <code>npm run dev</code>，会发现有找不到该资源文件的报错信息。</p>
<p>对于这个问题，我们可以手动将其拷贝至构建目录，然后在配置 <code>CleanWebpackPlugin</code> 时，注意不要清空对应的文件或文件夹即可，但是如若这个静态文件时不时的还会修改下，那么依赖于手动拷贝，是很容易出问题的。</p>
<p>不要过于相信自己的记性，依赖于手动拷贝的方式，大多数人应该都有过忘记拷贝的经历，你要是说你从来没忘过。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7eedad0932?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="050a81c7-59e4-4596-b08f-62cefce353d0.jpg"></p>
<p>幸运的是，<code>webpack</code> 为我们这些记性不好又爱偷懒的人提供了好用的插件 <a href="https://webpack.js.org/plugins/copy-webpack-plugin/" target="_blank" rel="noopener">CopyWebpackPlugin</a>，它的作用就是将单个文件或整个目录复制到构建目录。</p>
<p>首先安装一下依赖：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install copy-webpack-plugin -D</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>修改配置(当前，需要做的是将 <code>public/js</code> 目录拷贝至 <code>dist/js</code> 目录)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const CopyWebpackPlugin = require(&apos;copy-webpack-plugin&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new CopyWebpackPlugin([</span><br><span class="line">            &#123;</span><br><span class="line">                from: &apos;public/js/*.js&apos;,</span><br><span class="line">                to: path.resolve(__dirname, &apos;dist&apos;, &apos;js&apos;),</span><br><span class="line">                flatten: true,</span><br><span class="line">            &#125;,</span><br><span class="line">            //还可以继续配置其它要拷贝的文件</span><br><span class="line">        ])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>此时，重新执行 <code>npm run dev</code>，报错信息已经消失。</p>
<p>这里说一下 <code>flatten</code> 这个参数，设置为 <code>true</code>，那么它只会拷贝文件，而不会把文件夹路径都拷贝上，大家可以不设置 <code>flatten</code> 时，看下构建结果。</p>
<p>另外，如果我们要拷贝一个目录下的很多文件，但是想过滤掉某个或某些文件，那么 <code>CopyWebpackPlugin</code> 还为我们提供了 <code>ignore</code> 参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const CopyWebpackPlugin = require(&apos;copy-webpack-plugin&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new CopyWebpackPlugin([</span><br><span class="line">            &#123;</span><br><span class="line">                from: &apos;public/js/*.js&apos;,</span><br><span class="line">                to: path.resolve(__dirname, &apos;dist&apos;, &apos;js&apos;),</span><br><span class="line">                flatten: true,</span><br><span class="line">            &#125;</span><br><span class="line">        ], &#123;</span><br><span class="line">            ignore: [&apos;other.js&apos;]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>例如，这里我们忽略掉 <code>js</code> 目录下的 <code>other.js</code> 文件，使用 <code>npm run build</code> 构建，可以看到 <code>dist/js</code> 下不会出现 <code>other.js</code> 文件。 <code>CopyWebpackPlugin</code> 还提供了很多其它的参数，如果当前的配置不能满足你，可以查阅文档进一步修改配置。</p>
<h3 id="2-ProvidePlugin"><a href="#2-ProvidePlugin" class="headerlink" title="2.ProvidePlugin"></a>2.ProvidePlugin</h3><p><code>ProvidePlugin</code> 在我看来，是为懒人准备的，不过也别过度使用，毕竟全局变量不是什么“好东西”。<code>ProvidePlugin</code> 的作用就是不需要 <code>import</code> 或 <code>require</code> 就可以在项目中到处使用。</p>
<p><code>ProvidePlugin</code> 是 <code>webpack</code> 的内置插件，使用方式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">new webpack.ProvidePlugin(&#123;</span><br><span class="line">  identifier1: &apos;module1&apos;,</span><br><span class="line">  identifier2: [&apos;module2&apos;, &apos;property2&apos;]</span><br><span class="line">&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>默认寻找路径是当前文件夹 <code>./**</code> 和 <code>node_modules</code>，当然啦，你可以指定全路径。</p>
<p><code>React</code> 大家都知道的，使用的时候，要在每个文件中引入 <code>React</code>，不然立刻抛错给你看。还有就是 <code>jquery</code>, <code>lodash</code> 这样的库，可能在多个文件中使用，但是懒得每次都引入，好嘛，一起来偷个懒，修改下 <code>webpack</code> 的配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">const webpack = require(&apos;webpack&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new webpack.ProvidePlugin(&#123;</span><br><span class="line">            React: &apos;react&apos;,</span><br><span class="line">            Component: [&apos;react&apos;, &apos;Component&apos;],</span><br><span class="line">            Vue: [&apos;vue/dist/vue.esm.js&apos;, &apos;default&apos;],</span><br><span class="line">            $: &apos;jquery&apos;,</span><br><span class="line">            _map: [&apos;lodash&apos;, &apos;map&apos;]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这样配置之后，你就可以在项目中随心所欲的使用 <code>$</code>、<code>_map</code>了，并且写 <code>React</code> 组件时，也不需要 <code>import</code> <code>React</code> 和 <code>Component</code> 了，如果你想的话，你还可以把 <code>React</code> 的 <code>Hooks</code> 都配置在这里。</p>
<p>另外呢，<code>Vue</code> 的配置后面多了一个 <code>default</code>，这是因为 <code>vue.esm.js</code> 中使用的是 <code>export default</code> 导出的，对于这种，必须要指定 <code>default</code>。<code>React</code> 使用的是 <code>module.exports</code> 导出的，因此不要写 <code>default</code>。</p>
<p>另外，就是如果你项目启动了 <code>eslint</code> 的话，记得修改下 <code>eslint</code> 的配置文件，增加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;globals&quot;: &#123;</span><br><span class="line">        &quot;React&quot;: true,</span><br><span class="line">        &quot;Vue&quot;: true,</span><br><span class="line">        //....</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当然啦，偷懒要有个度，你要是配一大堆全局变量，最终可能会给自己带来麻烦，对自己配置的全局变量一定要负责到底。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7ef26d2ca3?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="u=2243033496,1576809017&amp;fm=15&amp;gp=0.jpg"></p>
<h3 id="3-抽离CSS"><a href="#3-抽离CSS" class="headerlink" title="3.抽离CSS"></a>3.抽离CSS</h3><p>CSS打包我们前面已经说过了，不过呢，有些时候，我们可能会有抽离CSS的需求，即将CSS文件单独打包，这可能是因为打包成一个JS文件太大，影响加载速度，也有可能是为了缓存(例如，只有JS部分有改动)，还有可能就是“我高兴”：我想抽离就抽离，谁也管不着。</p>
<p>不管你是因为什么原因要抽离CSS，只要你有需求，我们就可以去实现。</p>
<p>首先，安装 <code>loader</code>:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install mini-css-extract-plugin -D</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<blockquote>
<p><code>mini-css-extract-plugin</code> 和 <code>extract-text-webpack-plugin</code> 相比:</p>
</blockquote>
<ol>
<li>异步加载</li>
<li>不会重复编译(性能更好)</li>
<li>更容易使用</li>
<li>只适用CSS</li>
</ol>
<p>修改我们的配置文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const MiniCssExtractPlugin = require(&apos;mini-css-extract-plugin&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &apos;css/[name].css&apos;</span><br><span class="line">            //个人习惯将css文件放在单独目录下</span><br><span class="line">            //publicPath:&apos;../&apos;   //如果你的output的publicPath配置的是 &apos;./&apos; 这种相对路径，那么如果将css文件放在单独目录下，记得在这里指定一下publicPath </span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.(le|c)ss$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader, //替换之前的 style-loader</span><br><span class="line">                    &apos;css-loader&apos;, &#123;</span><br><span class="line">                        loader: &apos;postcss-loader&apos;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            plugins: function () &#123;</span><br><span class="line">                                return [</span><br><span class="line">                                    require(&apos;autoprefixer&apos;)(&#123;</span><br><span class="line">                                        &quot;overrideBrowserslist&quot;: [</span><br><span class="line">                                            &quot;defaults&quot;</span><br><span class="line">                                        ]</span><br><span class="line">                                    &#125;)</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, &apos;less-loader&apos;</span><br><span class="line">                ],</span><br><span class="line">                exclude: /node_modules/</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>现在，我们重新编译：<code>npm run build</code>，目录结构如下所示:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   ├── alita_e09b5c.jpg</span><br><span class="line">│   │   └── thor_e09b5c.jpeg</span><br><span class="line">│   ├── css</span><br><span class="line">│   │   ├── index.css</span><br><span class="line">│   │   └── index.css.map</span><br><span class="line">│   ├── bundle.fb6d0c.js</span><br><span class="line">│   ├── bundle.fb6d0c.js.map</span><br><span class="line">│   └── index.html</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>前面说了最好新建一个 <code>.browserslistrc</code> 文件，这样可以多个 <code>loader</code> 共享配置，所以，动手在根目录下新建文件 (<code>.browserslistrc</code>)，内容如下（你可以根据自己项目需求，修改为其它的配置）:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">last 2 version</span><br><span class="line">&gt; 0.25%</span><br><span class="line">not dead</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>修改 <code>webpack.config.js</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const MiniCssExtractPlugin = require(&apos;mini-css-extract-plugin&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new MiniCssExtractPlugin(&#123;</span><br><span class="line">            filename: &apos;css/[name].css&apos; </span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.(c|le)ss$/,</span><br><span class="line">                use: [</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    &apos;css-loader&apos;, &#123;</span><br><span class="line">                        loader: &apos;postcss-loader&apos;,</span><br><span class="line">                        options: &#123;</span><br><span class="line">                            plugins: function () &#123;</span><br><span class="line">                                return [</span><br><span class="line">                                    require(&apos;autoprefixer&apos;)()</span><br><span class="line">                                ]</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, &apos;less-loader&apos;</span><br><span class="line">                ],</span><br><span class="line">                exclude: /node_modules/</span><br><span class="line">            &#125;,</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>要测试自己的 <code>.browserlistrc</code> 有没有生效也很简单，直接将文件内容修改为 <code>last 1 Chrome versions</code> ，然后对比修改前后的构建出的结果，就能看出来啦。</p>
<p>可以查看更多[browserslistrc]配置项(<a href="https://github.com/browserslist/browserslist" target="_blank" rel="noopener">github.com/browserslis…</a>)</p>
<p>更多配置项，可以查看<a href="https://github.com/webpack-contrib/mini-css-extract-plugin" target="_blank" rel="noopener">mini-css-extract-plugin</a></p>
<h4 id="将抽离出来的css文件进行压缩"><a href="#将抽离出来的css文件进行压缩" class="headerlink" title="将抽离出来的css文件进行压缩"></a>将抽离出来的css文件进行压缩</h4><p>使用 <code>mini-css-extract-plugin</code>，<code>CSS</code> 文件默认不会被压缩，如果想要压缩，需要配置 <code>optimization</code>，首先安装 <code>optimize-css-assets-webpack-plugin</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install optimize-css-assets-webpack-plugin -D</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>修改webpack配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const OptimizeCssPlugin = require(&apos;optimize-css-assets-webpack-plugin&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = &#123;</span><br><span class="line">    entry: &apos;./src/index.js&apos;,</span><br><span class="line">    //....</span><br><span class="line">    plugins: [</span><br><span class="line">        new OptimizeCssPlugin()</span><br><span class="line">    ],</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>注意，这里将 <code>OptimizeCssPlugin</code> 直接配置在 <code>plugins</code> 里面，那么 <code>js</code> 和 <code>css</code> 都能够正常压缩，如果你将这个配置在 <code>optimization</code>，那么需要再配置一下 <code>js</code> 的压缩(开发环境下不需要去做CSS的压缩，因此后面记得将其放到 <code>webpack.config.prod.js</code> 中哈)。</p>
<p>配置完之后，测试的时候发现，抽离之后，修改 <code>css</code> 文件时，第一次页面会刷新，但是第二次页面不会刷新 —— 好嘛，我平时的业务中用不着抽离 <code>css</code>，这个问题搁置了好多天(准确来说是忘记了)。</p>
<p>3月8号再次修改这篇文章的时候，正好看到了 <code>MiniCssExtractPlugin.loader</code> 对应的 <code>option</code> 设置，我们再次修改下对应的 <code>rule</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    rules: [</span><br><span class="line">        &#123;</span><br><span class="line">            test: /\.(c|le)ss$/,</span><br><span class="line">            use: [</span><br><span class="line">                &#123;</span><br><span class="line">                    loader: MiniCssExtractPlugin.loader,</span><br><span class="line">                    options: &#123;</span><br><span class="line">                        hmr: isDev,</span><br><span class="line">                        reloadAll: true,</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                //...</span><br><span class="line">            ],</span><br><span class="line">            exclude: /node_modules/</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7ef4ea39dd?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="4-按需加载"><a href="#4-按需加载" class="headerlink" title="4.按需加载"></a>4.按需加载</h3><p>很多时候我们不需要一次性加载所有的JS文件，而应该在不同阶段去加载所需要的代码。<code>webpack</code>内置了强大的分割代码的功能可以实现按需加载。</p>
<p>比如，我们在点击了某个按钮之后，才需要使用使用对应的JS文件中的代码，需要使用 <code>import()</code> 语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">document.getElementById(&apos;btn&apos;).onclick = function() &#123;</span><br><span class="line">    import(&apos;./handle&apos;).then(fn =&gt; fn.default());</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>import()</code> 语法，需要 <code>@babel/plugin-syntax-dynamic-import</code> 的插件支持，但是因为当前 <code>@babel/preset-env</code> 预设中已经包含了 <code>@babel/plugin-syntax-dynamic-import</code>，因此我们不需要再单独安装和配置。</p>
<p>直接 <code>npm run build</code> 进行构建，构建结果如下：</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7ef6dc0875?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="WechatIMG1121.jpeg"></p>
<p><code>webpack</code> 遇到 <code>import(****)</code> 这样的语法的时候，会这样处理：</p>
<ul>
<li>以**** 为入口新生成一个 <code>Chunk</code></li>
<li>当代码执行到 <code>import</code> 所在的语句时，才会加载该 <code>Chunk</code> 所对应的文件（如这里的1.bundle.8bf4dc.js）</li>
</ul>
<p>大家可以在浏览器中的控制台中，在 <code>Network</code> 的 <code>Tab页</code> 查看文件加载的情况，只有点击之后，才会加载对应的 <code>JS</code> 。</p>
<h3 id="5-热更新"><a href="#5-热更新" class="headerlink" title="5.热更新"></a>5.热更新</h3><ol>
<li>首先配置 <code>devServer</code> 的 <code>hot</code> 为 <code>true</code></li>
<li>并且在 <code>plugins</code> 中增加 <code>new webpack.HotModuleReplacementPlugin()</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const webpack = require(&apos;webpack&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //....</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        hot: true</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        new webpack.HotModuleReplacementPlugin() //热更新插件</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>我们配置了 <code>HotModuleReplacementPlugin</code> 之后，会发现，此时我们修改代码，仍然是整个页面都会刷新。不希望整个页面都刷新，还需要修改入口文件：</p>
<ol>
<li>在入口文件中新增:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(module &amp;&amp; module.hot) &#123;</span><br><span class="line">    module.hot.accept()</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>此时，再修改代码，不会造成整个页面的刷新。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7ef7c6718b?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="6-多页应用打包"><a href="#6-多页应用打包" class="headerlink" title="6.多页应用打包"></a>6.多页应用打包</h3><p>有时，我们的应用不一定是一个单页应用，而是一个多页应用，那么如何使用 <code>webpack</code> 进行打包呢。为了生成目录看起来清晰，不生成单独的 <code>map</code> 文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">const path = require(&apos;path&apos;);</span><br><span class="line">const HtmlWebpackPlugin = require(&apos;html-webpack-plugin&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        index: &apos;./src/index.js&apos;,</span><br><span class="line">        login: &apos;./src/login.js&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, &apos;dist&apos;),</span><br><span class="line">        filename: &apos;[name].[hash:6].js&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &apos;./public/index.html&apos;,</span><br><span class="line">            filename: &apos;index.html&apos; //打包后的文件名</span><br><span class="line">        &#125;),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &apos;./public/login.html&apos;,</span><br><span class="line">            filename: &apos;login.html&apos; //打包后的文件名</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>如果需要配置多个 <code>HtmlWebpackPlugin</code>，那么 <code>filename</code> 字段不可缺省，否则默认生成的都是 <code>index.html</code>，如果你希望 <code>html</code> 的文件名中也带有 <code>hash</code>，那么直接修改 <code>fliename</code> 字段即可，例如: <code>filename: &#39;login.[hash:6].html&#39;</code>。</p>
<p>生成目录如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── dist</span><br><span class="line">│   ├── 2.463ccf.js</span><br><span class="line">│   ├── assets</span><br><span class="line">│   │   └── thor_e09b5c.jpeg</span><br><span class="line">│   ├── css</span><br><span class="line">│   │   ├── index.css</span><br><span class="line">│   │   └── login.css</span><br><span class="line">│   ├── index.463ccf.js</span><br><span class="line">│   ├── index.html</span><br><span class="line">│   ├── js</span><br><span class="line">│   │   └── base.js</span><br><span class="line">│   ├── login.463ccf.js</span><br><span class="line">│   └── login.html</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>看起来，似乎是OK了，不过呢，查看 <code>index.html</code> 和 <code>login.html</code> 会发现，都同时引入了 <code>index.f7d21a.js</code> 和 <code>login.f7d21a.js</code>，通常这不是我们想要的，我们希望，<code>index.html</code> 中只引入 <code>index.f7d21a.js</code>，<code>login.html</code> 只引入 <code>login.f7d21a.js</code>。</p>
<p><code>HtmlWebpackPlugin</code> 提供了一个 <code>chunks</code> 的参数，可以接受一个数组，配置此参数仅会将数组中指定的js引入到html文件中，此外，如果你需要引入多个JS文件，仅有少数不想引入，还可以指定 <code>excludeChunks</code> 参数，它接受一个数组。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    plugins: [</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &apos;./public/index.html&apos;,</span><br><span class="line">            filename: &apos;index.html&apos;, //打包后的文件名</span><br><span class="line">            chunks: [&apos;index&apos;]</span><br><span class="line">        &#125;),</span><br><span class="line">        new HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: &apos;./public/login.html&apos;,</span><br><span class="line">            filename: &apos;login.html&apos;, //打包后的文件名</span><br><span class="line">            chunks: [&apos;login&apos;]</span><br><span class="line">        &#125;),</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>执行 <code>npm run build</code>，可以看到 <code>index.html</code> 中仅引入了 <code>index</code> 的 <code>JS</code> 文件，而 <code>login.html</code> 中也仅引入了 <code>login</code> 的 <code>JS</code> 文件，符合我们的预期。</p>
<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7f6f69cfb5?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="7-resolve-配置"><a href="#7-resolve-配置" class="headerlink" title="7.resolve 配置"></a>7.resolve 配置</h3><p><code>resolve</code> 配置 <code>webpack</code> 如何寻找模块所对应的文件。<code>webpack</code> 内置 <code>JavaScript</code> 模块化语法解析功能，默认会采用模块化标准里约定好的规则去寻找，但你可以根据自己的需要修改默认的规则。</p>
<ol>
<li>modules</li>
</ol>
<p><code>resolve.modules</code> 配置 <code>webpack</code> 去哪些目录下寻找第三方模块，默认情况下，只会去 <code>node_modules</code> 下寻找，如果你我们项目中某个文件夹下的模块经常被导入，不希望写很长的路径，那么就可以通过配置 <code>resolve.modules</code> 来简化。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //....</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        modules: [&apos;./src/components&apos;, &apos;node_modules&apos;] //从左到右依次查找</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这样配置之后，我们 <code>import Dialog from &#39;dialog&#39;</code>，会去寻找 <code>./src/components/dialog</code>，不再需要使用相对路径导入。如果在 <code>./src/components</code> 下找不到的话，就会到 <code>node_modules</code> 下寻找。</p>
<ol>
<li>alias</li>
</ol>
<p><code>resolve.alias</code> 配置项通过别名把原导入路径映射成一个新的导入路径，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //....</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        alias: &#123;</span><br><span class="line">            &apos;react-native&apos;: &apos;@my/react-native-web&apos; //这个包名是我随便写的哈</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>例如，我们有一个依赖 <code>@my/react-native-web</code> 可以实现 <code>react-native</code> 转 <code>web</code>。我们代码一般下面这样:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import &#123; View, ListView, StyleSheet, Animated &#125; from &apos;react-native&apos;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>配置了别名之后，在转 web 时，会从 <code>@my/react-native-web</code> 寻找对应的依赖。</p>
<p>当然啦，如果某个依赖的名字太长了，你也可以给它配置一个短一点的别名，这样用起来比较爽，尤其是带有 <code>scope</code> 的包。</p>
<ol>
<li>extensions</li>
</ol>
<p>适配多端的项目中，可能会出现 <code>.web.js</code>, <code>.wx.js</code>，例如在转web的项目中，我们希望首先找 <code>.web.js</code>，如果没有，再找 <code>.js</code>。我们可以这样配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //....</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        extensions: [&apos;web.js&apos;, &apos;.js&apos;] //当然，你还可以配置 .json, .css</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>首先寻找 <code>../dialog.web.js</code> ，如果不存在的话，再寻找 <code>../dialog.js</code>。这在适配多端的代码中非常有用，否则，你就需要根据不同的平台去引入文件(以牺牲了速度为代价)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import dialog from &apos;../dialog&apos;;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当然，配置 <code>extensions</code>，我们就可以缺省文件后缀，在导入语句没带文件后缀时，会自动带上<code>extensions</code> 中配置的后缀后，去尝试访问文件是否存在，因此要将高频的后缀放在前面，并且数组不要太长，减少尝试次数。如果没有配置 <code>extensions</code>，默认只会找对对应的js文件。</p>
<ol>
<li>enforceExtension</li>
</ol>
<p>如果配置了 <code>resolve.enforceExtension</code> 为 <code>true</code>，那么导入语句不能缺省文件后缀。</p>
<ol>
<li>mainFields</li>
</ol>
<p>有一些第三方模块会提供多份代码，例如 <code>bootstrap</code>，可以查看 <code>bootstrap</code> 的 <code>package.json</code> 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;style&quot;: &quot;dist/css/bootstrap.css&quot;,</span><br><span class="line">    &quot;sass&quot;: &quot;scss/bootstrap.scss&quot;,</span><br><span class="line">    &quot;main&quot;: &quot;dist/js/bootstrap&quot;,</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>resolve.mainFields</code> 默认配置是 <code>[&#39;browser&#39;, &#39;main&#39;]</code>，即首先找对应依赖 <code>package.json</code> 中的 <code>brower</code> 字段，如果没有，找 <code>main</code> 字段。</p>
<p>如：<code>import &#39;bootstrap&#39;</code> 默认情况下，找得是对应的依赖的 <code>package.json</code> 的 <code>main</code> 字段指定的文件，即 <code>dist/js/bootstrap</code>。</p>
<p>假设我们希望，<code>import &#39;bootsrap&#39;</code> 默认去找 <code>css</code> 文件的话，可以配置 <code>resolve.mainFields</code> 为:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //....</span><br><span class="line">    resolve: &#123;</span><br><span class="line">        mainFields: [&apos;style&apos;, &apos;main&apos;] </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="8-区分不同的环境"><a href="#8-区分不同的环境" class="headerlink" title="8.区分不同的环境"></a>8.区分不同的环境</h3><p>目前为止我们 <code>webpack</code> 的配置，都定义在了 <code>webpack.config.js</code> 中，对于需要区分是开发环境还是生产环境的情况，我们根据 <code>process.env.NODE_ENV</code> 去进行了区分配置，但是配置文件中如果有多处需要区分环境的配置，这种显然不是一个好办法。</p>
<p>更好的做法是创建多个配置文件，如: <code>webpack.base.js</code>、<code>webpack.dev.js</code>、<code>webpack.prod.js</code>。</p>
<ul>
<li><code>webpack.base.js</code> 定义公共的配置</li>
<li><code>webpack.dev.js</code>：定义开发环境的配置</li>
<li><code>webpack.prod.js</code>：定义生产环境的配置</li>
</ul>
<p><a href="https://www.npmjs.com/package/webpack-merge" target="_blank" rel="noopener">webpack-merge</a> 专为 <code>webpack</code> 设计，提供了一个 <code>merge</code> 函数，用于连接数组，合并对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">npm install webpack-merge -D</span><br><span class="line">复制代码</span><br><span class="line">const merge = require(&apos;webpack-merge&apos;);</span><br><span class="line">merge(&#123;</span><br><span class="line">    devtool: &apos;cheap-module-eval-source-map&apos;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;a: 1&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [1,2,3]</span><br><span class="line">&#125;, &#123;</span><br><span class="line">    devtool: &apos;none&apos;,</span><br><span class="line">    mode: &quot;production&quot;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;a: 2&#125;,</span><br><span class="line">            &#123;b: 1&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [4,5,6],</span><br><span class="line">&#125;);</span><br><span class="line">//合并后的结果为</span><br><span class="line">&#123;</span><br><span class="line">    devtool: &apos;none&apos;,</span><br><span class="line">    mode: &quot;production&quot;,</span><br><span class="line">    module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;a: 1&#125;,</span><br><span class="line">            &#123;a: 2&#125;,</span><br><span class="line">            &#123;b: 1&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [1,2,3,4,5,6]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p><code>webpack.config.base.js</code> 中是通用的 <code>webpack</code> 配置，以 <code>webpack.config.dev.js</code> 为例，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.dev.js</span><br><span class="line">const merge = require(&apos;webpack-merge&apos;);</span><br><span class="line">const baseWebpackConfig = require(&apos;./webpack.config.base&apos;);</span><br><span class="line"></span><br><span class="line">module.exports = merge(baseWebpackConfig, &#123;</span><br><span class="line">    mode: &apos;development&apos;</span><br><span class="line">    //...其它的一些配置</span><br><span class="line">&#125;);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>然后修改我们的 <code>package.json</code>，指定对应的 <code>config</code> 文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//package.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;scripts&quot;: &#123;</span><br><span class="line">        &quot;dev&quot;: &quot;cross-env NODE_ENV=development webpack-dev-server --config=webpack.config.dev.js&quot;,</span><br><span class="line">        &quot;build&quot;: &quot;cross-env NODE_ENV=production webpack --config=webpack.config.prod.js&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>你可以使用 <code>merge</code> 合并，也可以使用 <code>merge.smart</code> 合并，<code>merge.smart</code> 在合并<code>loader</code>时，会将同一匹配规则的进行合并，<code>webpack-merge</code> 的说明文档中给出了详细的示例。</p>
<h3 id="9-定义环境变量"><a href="#9-定义环境变量" class="headerlink" title="9.定义环境变量"></a>9.定义环境变量</h3><p>很多时候，我们在开发环境中会使用预发环境或者是本地的域名，生产环境中使用线上域名，我们可以在 <code>webpack</code> 定义环境变量，然后在代码中使用。</p>
<p>使用 <code>webpack</code> 内置插件 <code>DefinePlugin</code> 来定义环境变量。</p>
<p><code>DefinePlugin</code> 中的每个键，是一个标识符.</p>
<ul>
<li>如果 <code>value</code> 是一个字符串，会被当做 <code>code</code> 片段</li>
<li>如果 <code>value</code> 不是一个字符串，会被<code>stringify</code></li>
<li>如果 <code>value</code> 是一个对象，正常对象定义即可</li>
<li>如果 <code>key</code> 中有 <code>typeof</code>，它只针对 <code>typeof</code> 调用定义</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.dev.js</span><br><span class="line">const webpack = require(&apos;webpack&apos;);</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    plugins: [</span><br><span class="line">        new webpack.DefinePlugin(&#123;</span><br><span class="line">            DEV: JSON.stringify(&apos;dev&apos;), //字符串</span><br><span class="line">            FLAG: &apos;true&apos; //FLAG 是个布尔类型</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br><span class="line">//index.js</span><br><span class="line">if(DEV === &apos;dev&apos;) &#123;</span><br><span class="line">    //开发环境</span><br><span class="line">&#125;else &#123;</span><br><span class="line">    //生产环境</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>



<p><img src="https://user-gold-cdn.xitu.io/2020/3/9/170bae7f724b6757?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="img"></p>
<h3 id="10-利用webpack解决跨域问题"><a href="#10-利用webpack解决跨域问题" class="headerlink" title="10.利用webpack解决跨域问题"></a>10.利用webpack解决跨域问题</h3><p>假设前端在3000端口，服务端在4000端口，我们通过 <code>webpack</code> 配置的方式去实现跨域。</p>
<p>首先，我们在本地创建一个 <code>server.js</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">let express = require(&apos;express&apos;);</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">app.get(&apos;/api/user&apos;, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;name: &apos;刘小夕&apos;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(4000);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>执行代码(<code>run code</code>)，现在我们可以在浏览器中访问到此接口: <code>http://localhost:4000/api/user</code>。</p>
<p>在 <code>index.js</code> 中请求 <code>/api/user</code>，修改 <code>index.js</code> 如下:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//需要将 localhost:3000 转发到 localhost:4000（服务端） 端口</span><br><span class="line">fetch(&quot;/api/user&quot;)</span><br><span class="line">    .then(response =&gt; response.json())</span><br><span class="line">    .then(data =&gt; console.log(data))</span><br><span class="line">    .catch(err =&gt; console.log(err));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>我们希望通过配置代理的方式，去访问 4000 的接口。</p>
<h4 id="配置代理"><a href="#配置代理" class="headerlink" title="配置代理"></a>配置代理</h4><p>修改 <code>webpack</code> 配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            &quot;/api&quot;: &quot;http://localhost:4000&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>重新执行 <code>npm run dev</code>，可以看到控制台打印出来了 <code>{name: &quot;刘小夕&quot;}</code>，实现了跨域。</p>
<p>大多情况，后端提供的接口并不包含 <code>/api</code>，即：<code>/user</code>，<code>/info</code>、<code>/list</code> 等，配置代理时，我们不可能罗列出每一个api。</p>
<p>修改我们的服务端代码，并重新执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//server.js</span><br><span class="line">let express = require(&apos;express&apos;);</span><br><span class="line"></span><br><span class="line">let app = express();</span><br><span class="line"></span><br><span class="line">app.get(&apos;/user&apos;, (req, res) =&gt; &#123;</span><br><span class="line">    res.json(&#123;name: &apos;刘小夕&apos;&#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.listen(4000);</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>尽管后端的接口并不包含 <code>/api</code>，我们在请求后端接口时，仍然以 <code>/api</code> 开头，在配置代理时，去掉 <code>/api</code>，修改配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//webpack.config.js</span><br><span class="line">module.exports = &#123;</span><br><span class="line">    //...</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        proxy: &#123;</span><br><span class="line">            &apos;/api&apos;: &#123;</span><br><span class="line">                target: &apos;http://localhost:4000&apos;,</span><br><span class="line">                pathRewrite: &#123;</span><br><span class="line">                    &apos;/api&apos;: &apos;&apos;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>重新执行 <code>npm run dev</code>，在浏览器中访问： <code>http://localhost:3000/</code>，控制台中也打印出了<code>{name: &quot;刘小夕&quot;}</code>，跨域成功，</p>
<h3 id="11-前端模拟数据"><a href="#11-前端模拟数据" class="headerlink" title="11.前端模拟数据"></a>11.前端模拟数据</h3><blockquote>
<p>简单数据模拟</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        before(app) &#123;</span><br><span class="line">            app.get(&apos;/user&apos;, (req, res) =&gt; &#123;</span><br><span class="line">                res.json(&#123;name: &apos;刘小夕&apos;&#125;)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>在 <code>src/index.js</code> 中直接请求 <code>/user</code> 接口。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fetch(&quot;user&quot;)</span><br><span class="line">    .then(response =&gt; response.json())</span><br><span class="line">    .then(data =&gt; console.log(data))</span><br><span class="line">    .catch(err =&gt; console.log(err));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 mocker-api mock数据接口</p>
</blockquote>
<p>mocker-api 为 REST API 创建模拟 API。在没有实际 REST API 服务器的情况下测试应用程序时，它会很有用。</p>
<ol>
<li>安装 <a href="https://www.npmjs.com/package/mocker-api" target="_blank" rel="noopener">mocker-api</a>:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install mocker-api -D</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<ol>
<li>在项目中新建mock文件夹，新建 mocker.js.文件，文件如下:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">module.exports = &#123;</span><br><span class="line">    &apos;GET /user&apos;: &#123;name: &apos;刘小夕&apos;&#125;,</span><br><span class="line">    &apos;POST /login/account&apos;: (req, res) =&gt; &#123;</span><br><span class="line">        const &#123; password, username &#125; = req.body</span><br><span class="line">        if (password === &apos;888888&apos; &amp;&amp; username === &apos;admin&apos;) &#123;</span><br><span class="line">            return res.send(&#123;</span><br><span class="line">                status: &apos;ok&apos;,</span><br><span class="line">                code: 0,</span><br><span class="line">                token: &apos;sdfsdfsdfdsf&apos;,</span><br><span class="line">                data: &#123; id: 1, name: &apos;刘小夕&apos; &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            return res.send(&#123; status: &apos;error&apos;, code: 403 &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<ol>
<li>修改 <code>webpack.config.base.js</code>:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">const apiMocker = require(&apos;mocker-api&apos;);</span><br><span class="line">module.export = &#123;</span><br><span class="line">    //...</span><br><span class="line">    devServer: &#123;</span><br><span class="line">        before(app)&#123;</span><br><span class="line">            apiMocker(app, path.resolve(&apos;./mock/mocker.js&apos;))</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>这样，我们就可以直接在代码中像请求后端接口一样对mock数据进行请求。</p>
<ol>
<li>重启 <code>npm run dev</code>，可以看到，控制台成功打印出来 <code>{name: &#39;刘小夕&#39;}</code></li>
<li>我们再修改下 <code>src/index.js</code>，检查下POST接口是否成功</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//src/index.js</span><br><span class="line">fetch(&quot;/login/account&quot;, &#123;</span><br><span class="line">    method: &quot;POST&quot;,</span><br><span class="line">    headers: &#123;</span><br><span class="line">        &apos;Accept&apos;: &apos;application/json&apos;,</span><br><span class="line">        &apos;Content-Type&apos;: &apos;application/json&apos;</span><br><span class="line">    &#125;,</span><br><span class="line">    body: JSON.stringify(&#123;</span><br><span class="line">        username: &quot;admin&quot;,</span><br><span class="line">        password: &quot;888888&quot;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">    .then(response =&gt; response.json())</span><br><span class="line">    .then(data =&gt; console.log(data))</span><br><span class="line">    .catch(err =&gt; console.log(err));</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>可以在控制台中看到接口返回的成功的数据。</p>
<p>进阶篇就到这里结束啦，最后一篇是优化篇。</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/webpack/" rel="tag"># webpack</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2020/02/03/%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%BA%A6%E8%A7%A3%E9%94%81Webpack%E7%B3%BB%E5%88%97(%E5%9F%BA%E7%A1%80%E7%AF%87)/" rel="next" title="深度解锁Webpack系列(基础篇)">
                <i class="fa fa-chevron-left"></i> 深度解锁Webpack系列(基础篇)
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/02/05/%E5%B8%A6%E4%BD%A0%E6%B7%B1%E5%BA%A6%E8%A7%A3%E9%94%81Webpack%E7%B3%BB%E5%88%97(%E4%BC%98%E5%8C%96%E7%AF%87)/" rel="prev" title="深度解锁Webpack系列(优化篇)">
                深度解锁Webpack系列(优化篇) <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">STAO</p>
              <p class="site-description motion-element" itemprop="description">前端学习</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">29</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          
		<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=1399664349&auto=1&height=66"></iframe>
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#带你深度解锁Webpack系列-进阶篇"><span class="nav-number">1.</span> <span class="nav-text">带你深度解锁Webpack系列(进阶篇)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-静态资源拷贝"><span class="nav-number">1.0.1.</span> <span class="nav-text">1. 静态资源拷贝</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-ProvidePlugin"><span class="nav-number">1.0.2.</span> <span class="nav-text">2.ProvidePlugin</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-抽离CSS"><span class="nav-number">1.0.3.</span> <span class="nav-text">3.抽离CSS</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#将抽离出来的css文件进行压缩"><span class="nav-number">1.0.3.1.</span> <span class="nav-text">将抽离出来的css文件进行压缩</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-按需加载"><span class="nav-number">1.0.4.</span> <span class="nav-text">4.按需加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-热更新"><span class="nav-number">1.0.5.</span> <span class="nav-text">5.热更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-多页应用打包"><span class="nav-number">1.0.6.</span> <span class="nav-text">6.多页应用打包</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-resolve-配置"><span class="nav-number">1.0.7.</span> <span class="nav-text">7.resolve 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-区分不同的环境"><span class="nav-number">1.0.8.</span> <span class="nav-text">8.区分不同的环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-定义环境变量"><span class="nav-number">1.0.9.</span> <span class="nav-text">9.定义环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-利用webpack解决跨域问题"><span class="nav-number">1.0.10.</span> <span class="nav-text">10.利用webpack解决跨域问题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#配置代理"><span class="nav-number">1.0.10.1.</span> <span class="nav-text">配置代理</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-前端模拟数据"><span class="nav-number">1.0.11.</span> <span class="nav-text">11.前端模拟数据</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2019 &mdash; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">STAO</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
